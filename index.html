<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Rune Transmutation</title>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Common/Utils.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Common/Queue.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Common/PriorityQueue.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Common/UniquePriorityQueue.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Color.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Constants.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/EventType.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Event.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Screen.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/PixPathTypes.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/CharacterMap.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/CharacterRenderer.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/Layer.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/TextPrompt.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/TextLayer.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/GfxLayer.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/PixRenderer.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/GfxElementZIndexComparable.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/MoveOrder.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/GfxElement.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/TextElement.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/PixElement.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/TextLink.js"></script>
  <script type="text/javascript" src="./bower_components/C64Style/lib/TextButton.js"></script>
  <script type="text/javascript" src="./lib/LocalStorage.js"></script>
  <script type="text/javascript" src="./lib/Utils.js"></script>
  <script type="text/javascript" src="./lib/Constants.js"></script>
  <script type="text/javascript" src="./config.js"></script>
  <script type="text/javascript" src="./lib/RuneMaps.js"></script>
  <script type="text/javascript" src="./lib/RuneTile.js"></script>
  <script type="text/javascript" src="./lib/RuneCell.js"></script>
  <script type="text/javascript" src="./lib/BackgroundLayer.js"></script>
  <script type="text/javascript" src="./lib/ScoreRenderer.js"></script>
  <script type="text/javascript" src="./lib/GraveyardRenderer.js"></script>
  <script type="text/javascript" src="./lib/LevelRenderer.js"></script>
  <script type="text/javascript" src="./lib/BoardBackground.js"></script>
  <script type="text/javascript" src="./lib/BoardForeground.js"></script>
  <script type="text/javascript" src="./lib/GameBoard.js"></script>
  <script type="text/javascript" src="./lib/GameStorage.js"></script>
  <script type="text/javascript" src="./lib/LevelJumpManager.js"></script>
  <script type="text/javascript" src="./lib/GameEngine.js"></script>
  <script type="text/javascript" src="LevelDefinitions.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
<style>
#levelJump {
  padding-top: 10px
}
#instructions {
  width: 512px
}
</style>
</head>
<body>
  <div id="content" class="center">
  </div>
  <div id="levelJump" class="center">
  </div>
  <div id="instructions" class="center">
    <h3>Rune Transmutation - How To Play</h3>
    <p>The goal of the game is to transform the color of the board.  Each rune placed
      on the board will change the color of the board under the rune.  Early levels
      only require changing the color of each board tile once (from darkgrey to blue), but higher levels
      may require changing the board color two or more times.  Refer to the transmute
      guide underneath the current level indicator.
    </p>
    <p>
      The board starts empty, except for a starting rune (ingwaz, a diamond shape).
      Any rune can be placed adjacent to the starting rune.  <b><u>To place a rune, click in a free space adjacent to
      one or more compatible runes that are already on the board. </u></b>
    </p>
    <p>
      In order to place a rune, the rune must match either the color or symbol of all adjacent runes.
    </p>
    <p><b><u>Desktop Machines</u></b><br/>
      If you have a mouse, the current rune will follow the mouse movement.
      Click to drop the rune on the board at the current mouse location (if adjacent runes are compatible),
      or in the graveyard.
    </p>
    <p><b><u>Mobile</u></b><br/>
      The current rune will reside in a box in the top left corner.
      Touch the board next to a color/symbol matching rune on the board to place the rune,
      or touch the graveyard to discard the rune.
    </p>
    <p><b><u>Clearing Lines</u></b><br/>
      When an entire row or column is filled with runes, all runes in that row
      or column will disappear, leaving the underlying board color as it was. Use this to your advantage
      to free up space on the board.
    </p>
    <p><b><u>Graveyard</u></b><br/>
      If you are unable to place a rune on the board, you may click on the graveyard
      to discard the rune.  Use this option sparingly, as one the graveyard is full, any
      further discards will end the game.
    </p>
    <p><b><u>Losing</u></b><br/>
      The game will be lost if a rune is discarded when the graveyard is full,
      or if all runes are cleared from the board, but the board has not been transformed to the target color
      (where it would be impossible to place any further runes).
    </p>
    <p><b><u>Special Runes</u></b><br/>
      Two special runes exist: "wild card" runes and "eraser" runes.</p>
    <p><b><u>Wild card runes</u></b><br/>
      These runes (ingwaz, a diamond shape) match any runes regardless of color or shape.
      The starting rune is a wild rune.  Rarely, you may be given a wild rune as your current placeable rune.
      It can be placed next to any other rune or runes, and any subsequent runes may be placed next to it,
      so use it wisely!
    </p>
    <p>
      <b><u>Eraser Runes</u></b><br/>
      Rarely, you may be given one of these runes (gebo, an 'X' shape).
      They will destroy any other rune. Place them on top
      of a current rune on the board to destroy that rune, leaving the underlying board color. OR, place the rune in the
      graveyard to remove the last rune placed in the graveyard.
    </p>
    <p><b><u>Tips</u></b><br/>
      Each level increases difficulty by adding additional rune symbols, or colors, that can pop up.  Higher
      levels will require each board tile to be transmuted multiple times.
    </p>
    <p><b>Rune Transmutation is maintained by Shaun Lusk.</br>
      The source code for this game is freely available under the MIT license at
        <a href="https://github.com/shaunlusk/RuneTransmutation">Github</a>.</b>
    </p>
  </div>
  <script type="text/javascript">
  var RuneTx = RuneTx || {};
  RuneTx.GameContext = RuneTx.GameContext || {};

  var config = {
      "rows" : 34,
      "cols" : 34,
      "scaleX" : 2,
      "scaleY" : 2,
      "borderColor" : C64Style.Color.DARKGREY,
      "borderSize" : 2,
      "backgroundColor" : C64Style.Color.BLACK
    };

  var screen = null, textLayer = null, gfxLayer, floatLayer,
    gameboard = null, gameEngine = null, ljManager = null;

  function initialize(targetDiv, config) {

    // Create the C64 Screen
    screen = new C64Style.Screen(targetDiv, config);
    screen.initialize();

    textLayer = new RuneTx.BackgroundLayer(screen, RuneTx.createCanvas(targetDiv, screen.getWidth(), screen.getHeight()), {width:screen.getWidth(), height:screen.getHeight()});
    screen.addLayer(textLayer);
    gfxLayer = screen.createLayer("GfxLayer");
    floatLayer = screen.createLayer("GfxLayer");
    textFloatLayer = screen.createLayer("GfxLayer");
    screen.render();

    // TODO temp, remove later
    gfxLayer.identifier = "fg";
    floatLayer.identifier = "float";
    textFloatLayer.identifier = "textFloat";

    var props = {
      boardOffsetX : 32,
      boardOffsetY : 24,
      levelDefinitions : RuneTx.levelDefinitions,
      levelDefinitionsVersion : RuneTx.levelDefinitionsVersion,
      discardsAllowed : 3,
      graveOffsetX : 1 *  C64Style.CELLWIDTH,
      graveOffsetY : 23 * C64Style.CELLHEIGHT,
      screenContext: screen,
      backgroundLayer: textLayer,
      foregroundLayer: gfxLayer,
      floatLayer: floatLayer,
      textFloatLayer: textFloatLayer
    };
    gameEngine = new RuneTx.GameEngine(props);


    var ljConfig = {
      "targetElement":document.getElementById("levelJump"),
      gameEngine:gameEngine,
      textColor:C64Style.Color.GREY
    };
    ljManager = new RuneTx.LevelJumpManager(ljConfig);

    if (RuneTx.GameStorage.savedGameExists()) {
      gameEngine.loadSavedGame();
    } else {
      gameEngine.initializeSaveGame();
      gameEngine.startRound(0);
    }
  }

  initialize(document.getElementById("content"), config);
  </script>
</body>
</html>
